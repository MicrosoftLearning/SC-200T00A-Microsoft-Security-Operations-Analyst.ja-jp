---
lab:
  title: 演習 2 - Microsoft Sentinel でのノートブックを使用した脅威ハンティング
  module: Learning Path 10 - Perform threat hunting in Microsoft Sentinel
---

# ラーニング パス 10 - ラボ 1 - 演習 2 - Microsoft Sentinel でのノートブックを使用した脅威ハンティング

## ラボのシナリオ

あなたは Microsoft Sentinel を実装した企業で働いているセキュリティ運用アナリストです。 Microsoft Sentinel Notebooks を使った脅威ハンティングの利点を調査する必要があります。 Notebooks は次の用途に使用できます。

- 一部の Python 機械学習機能など、Microsoft Sentinel ではすぐに使うことのできない分析を実行する。
- カスタムのタイムラインやプロセス ツリーなど、Microsoft Sentinel ではすぐに使うことのできないデータ視覚化を作成する。
- オンプレミスのデータ セットなど、Microsoft Sentinel の外部にあるデータ ソースを統合する

>**重要:** ラーニング パス #10 のラボ演習は、*スタンドアロン*環境にあります。 ラボを完了せずに終了する場合は、構成を再実行する必要があります。

### このラボの推定所要時間: 30 分

### タスク 1:ノートブックの探索

このタスクでは、Microsoft Sentinel で Notebooks を使用する方法について説明します。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd**。  

1. Microsoft Edge ブラウザーで、Azure portal (<https://portal.azure.com> ) に移動します。

1. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントの電子メール** アカウントをコピーして貼り付け、**[次へ]** を選択します。

1. **[パスワードの入力]** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントパスワード**をコピーして貼り付け、**[サインイン]** を選択します。

1. Azure portal の検索バーに「*Sentinel*」と入力してから、**[Microsoft Sentinel]** を選択します。

1. Microsoft Sentinel ワークスペースを選択します。

1. Microsoft Sentinel ワークスペースで、 *[脅威の管理]* 領域の下にある **[ノートブック]** を選択します。

1. 次に、Azure Machine Learning ワークスペースを作成する必要があります。 **[Azure Machine Learning の構成]** を選択し、コマンド バーの **[新しい Azure ML ワークスペースの作成]** ボタンを選択します。

1. [サブスクリプション] ボックスでお使いのサブスクリプションを選択します。

1. リソース グループの **[新規作成]** を選択し、名前として「*RG-MachineLearning*」と入力して、**[OK]** を選択します。 

1. ワークスペースの詳細 セクションで次の作業を行います。

     - お使いのワークスペースに一意の名前を付けます。
     - *[リージョン]* の既定値は **[米国東部]** のままにします。
     - 既定のストレージ アカウント、キーボールト、およびアプリケーション インサイト情報を保持します。
     - [コンテナー レジストリ] オプションは、**[なし]** のままにできます。

1. ページの下部で **[確認および作成]** を選択します。 *検証に成功しました* というメッセージが表示されたら、 **[作成]** を選択します。 

     >**注:**  Machine Learning ワークスペースのデプロイには数分かかる場合があります。

1. *デプロイが完了しました* というメッセージが表示されたら、Microsoft Sentinel ポータルに戻ります。

1. **[ノートブック]** をもう一度選択し、中央のコマンド バーから **[テンプレート]** タブを選択します。 

1. **[Microsoft Sentinel ML ノートブックのファースト ステップ ガイド]** を選択します。

1. 右側のペインで下にスクロールし、**[テンプレートから作成]** ボタンを選択します。 既定のオプションを確認してから、 **[保存]** を選択します。

1. 保存が完了したら、**[ノートブックの起動]** ボタンを選択します。 これにより Microsoft Azure Machine Learning スタジオに移動します。

1. Microsoft Azure Machine Learning スタジオで情報ウィンドウが表示されたら、**[閉じる]** を選択します。

1. コマンド バーの **[コンピューティング]** セレクターの右側にある **[+]** シンボルを選択し、*Azure ML コンピューティング インスタンスを作成*します。 **ヒント:** 省略記号アイコン **[...]** 内にあり表示されていない場合があります。

     >**注:**  "ハンバーガー メニュー"** (左上にある 3 本線) を選んで Azure ML スタジオの左側のブレードを非表示にし、**<<** アイコンを選んで Notebooks Files を折りたたむことでスクリーン スペースを増やすことができます。

1. *[コンピューティング名]* フィールドに一意の名前を入力します。 これにより、お使いのコンピューティング インスタンスが識別されます。

1. 下にスクロールし、使用可能な最初のオプションを選択します。 **ヒント:** ワークロードの種類:Notebooks (またはその他の IDE) での開発と軽量テスト。

1. 画面下の **[確認および作成]** ボタンを選んだら、下にスクロールして **[作成]** を選びます。 表示される可能性のあるフィードバック ウィンドウをすべて閉じます。 これには数分かかります。完了すると通知 (ベル アイコン) が表示され、"コンピューティング インスタンス" の左側にあるアイコンが青から緑に変わります。**

1. コンピューティングが作成されて実行されたら、使用するカーネルが "Python 3.8 - Pytorch および Tensorflow"** であることを確認します。 **ヒント:** これは、コマンド バーの右側に表示されます。

1. **[認証]** ボタンを選択し、認証が完了するまで待ちます。

1. コマンド バーの **[すべての出力のクリア]** (消しゴムアイコン) を選んで Notebook の結果をすべてクリアし、「作業の開始」** チュートリアルに従います。 **ヒント:** これは、コマンド バーから省略記号 (...) を選択することで確認できます。

1. Notebook の「1 概要」セクション** を確認し、「2 Notebook と MSTICPy の初期化」** セクションに進みます。

1. 「2 Notebook と MSTICPy の初期化」** セクションで、Notebook の初期化と MSTICPy パッケージのインストールに関する内容を確認します。

1. "Python コード"** を実行し、コードの左側にある **[セルの実行]** ボタン ([再生] アイコン) を選択して、セルを初期化します。

1. 実行には約 15 分かかります。 完了したら、出力メッセージを確認します (Python カーネルのバージョンに関する警告は無視します)。 左側にある "エクスプローラー"** ペインの *utils* フォルダーに *msticpyconfig.yaml * が作成された場合、コードは正常に実行されたことになります。 そのファイルが表示されるまでにさらに 30 秒かかる場合があります。

    >**ヒント:** *出力メニュー*のコード ウィンドウの左側にある省略記号 (...) を選択し *[出力のクリア]* (x* の四角形) アイコンを選択すると、出力メッセージをクリアできます。

1. 左側の "エクスプローラー"** ペインで **msticpyconfig.yaml** ファイルを選び、ファイルの内容を確認してから閉じます。

1. 「3 MSTICPy を使用したデータのクエリ」セクション** に進み、内容を確認します。 *複数の Microsoft Sentinel ワークスペース*コード セルは失敗するので実行しないでください。ただし、他のコード セルは正常に実行できます。

>**注:** 上の手順のようにしてもノートブックにアクセスできない場合は、代わりにその GitHub ビューアー ページで手順のようにしてもかまいません。 [Azure ML ノートブックと Microsoft Sentinel の概要](https://nbviewer.org/github/Azure/Azure-Sentinel-Notebooks/blob/master/A%20Getting%20Started%20Guide%20For%20Azure%20Sentinel%20ML%20Notebooks.ipynb) 

## これでラボは完了です
