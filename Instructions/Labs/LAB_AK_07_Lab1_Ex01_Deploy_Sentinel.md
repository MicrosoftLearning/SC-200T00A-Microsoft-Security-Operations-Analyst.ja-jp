---
lab:
  title: 演習 1 - Microsoft Sentinel 環境を構成する
  module: Learning Path 7 - Configure your Microsoft Sentinel environment
---

# ラーニング パス 7 - ラボ 1 - 演習 1 - Microsoft Sentinel 環境を構成する

## ラボのシナリオ

あなたは、Microsoft Sentinel を実装しようとしている会社で働いているセキュリティ運用アナリストです。 コストを最小限に抑え、コンプライアンス規制を満たし、セキュリティ チームが日常の職務を遂行するのに最も管理しやすい環境を提供するという会社の要件を満たすように、Microsoft Sentinel 環境を設定する責任があります。

>**重要:** ラーニング パス #7 のラボ演習は、*スタンドアロン*環境にあります。 ラボを完了せずに終了する場合は、構成を再実行する必要があります。

### このラボの推定所要時間: 30 分

### タスク 1 - Log Analytics ワークスペースを作成する

リージョン オプションを含む Log Analytics ワークスペースを作成します。 詳細については、[Microsoft Sentinel のオンボーディング](https://learn.microsoft.com/azure/sentinel/quickstart-onboard)を参照してください。

1. 管理者として **WIN1** 仮想マシンにログインします。パスワードは **Pa55w.rd** です。

1. Microsoft Edge ブラウザーで、Azure portal (<https://portal.azure.com> ) に移動します。
  
1. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーの提供した管理者ユーザー名のテナント電子メール アカウントをコピーして貼り付け、**[次へ]** を選択します。

1. **パスワードの入力**ダイアログ ボックスで、ラボ ホスティング プロバイダーの提供した管理者のテナント パスワードをコピーして貼り付け、**サインイン**します。

1. Azure portal の検索バーに「Microsoft Sentinel」と入力し、選択します。

1. **[+ 作成]** を選択します。

1. **[新しいワークスペースの作成]** を選択します。

1. リソース グループの **[新規作成]** を選択します。

1. 「*Defender-RG*」と入力し、**[OK]** を選択します。

1. [名前] に「*defenderWorkspace*」と入力します。

1. ワークスペースの既定のリージョンは、そのままにしておいてかまいません。

1. **[確認と作成]** を新しいワークスペースを検証します。

1. **[作成]** を選択して、ワークスペースをデプロイします。

### タスク 2 - Microsoft Sentinel をワークスペースにデプロイする

Microsoft Sentinel をワークスペースにデプロイします。

1. ワークスペースのデプロイが完了したら、Microsoft Azure の [階層リンク] メニューから **[ホーム]** を選択します。

1. ポータルの *[Azure サービス]* セクションに **Microsoft Sentinel** が表示されます。 それを選択します。

1. メニュー項目から **[+ 作成]** を選択します。

1. Sentinel を追加するワークスペース (タスク 1 で作成したもの) を選択します。

1. **[追加]** を選択します。

### タスク 3 - データ保持を構成する

1. Microsoft Azure の "階層リンク" メニューで、**[ホーム]** を選択します。

1. Azure portal の検索バーで、「ログ分析」と入力し、タスク 1 で作成したワークスペースを選択します。

1. ナビゲーション メニューの *[設定]* セクションを展開し、**[使用量と推定コスト]** を選択します。

1. メニュー項目から **[データ保持]** を選択します。

1. データ保持期間を **180 日**に変更します。

1. **[OK]** を選択します。

### タスク 4: ウォッチリストを作成する

このタスクでは、Microsoft Sentinel でウォッチリストを作成します。

1. Windows 10 の画面下部の検索ボックスに *Notepad* と入力します。 結果から、**[Notepad]** を選択します。

1. *Hostname* と入力し、新しい行を入力します。

1. メモ帳の 2 行目から、次のホスト名を 1 行に 1 つずつコピーします。

    ```Notepad
    Host1
    Host2
    Host3
    Host4
    Host5
    ```

1. メニューから **[ファイル] - [名前を付けて保存]** を選択し、ファイルに *[HighValue.csv]* という名前を付けて、ファイルの種類を **[すべてのファイル (*.*)]** に変更し、**[保存]** を選択します。 **ヒント:** ファイルは *[ドキュメント]* フォルダーに保存できます。

1. メモ帳を閉じます。

1. Microsoft Azure の [階層リンク] メニューから **[ホーム]** を選択します。

1. ポータルの *[Azure サービス]* セクションに **Microsoft Sentinel** が表示されます。 それを選択します。

1. Microsoft Sentinel で、[構成] 領域の **[ウォッチリスト]** オプションを選択します。

1. コマンド バーから **[+ 新規]** を選択します。

1. ウォッチリスト ウィザードで、次のように入力します。

    |全般設定|値|
    |---|---|
    |名前|**HighValueHosts**|
    |説明|**High Value Hosts**|
    |ウォッチリスト エイリアス|**HighValueHosts**|

1. **[次へ: ソース >]** を選択します。

1. *[ファイルのアップロード]* で **[ファイルを参照]** を選択し、作成した *HighValue.csv* ファイルを参照します。

1. *[検索キー]* フィールドで、 **[ホスト名]** を選択します。

1. **[次へ: 確認と作成 >]** を選択します。

1. 入力した設定を確認し、 **[作成]** を選びます。

1. 画面が [ウォッチリスト] ページに戻ります。

1. メニューから **[更新]** を選択して、新しいウォッチリストを表示します。

1. *HighValueHosts* ウォッチリストを選択し、右側のペインで **[ログに表示]** を選択します。

    >**重要:** ウォッチリストが表示されるまでに最大 10 分かかる場合があります。 **次のタスクを続けて行い、このコマンドは次のラボで実行してください**。

    >**注:**  独自のKQLステートメントで_GetWatchlist（ 'HighValueHosts'）を使用して、リストにアクセスできるようになりました。 参照する列は*Hostname*になります。

1. 右上にある [x] を選択して *[ログ]* ウィンドウを閉じ、 **[OK]** を選択して保存されていない変更を破棄します。

### タスク 5: 脅威インジケーターを作成する

このタスクでは、Microsoft Sentinel でインジケーターを作成します。

1. Microsoft Sentinel で、[脅威の管理] 領域の **[脅威インテリジェンス]** オプションを選択します。

1. コマンド バーから **[+ 新規追加]** を選択します。

1. **TI オブジェクト**を選択します。

1. *[オブジェクト型]* ドロップダウンから **[インジケーター]** を選択します。

1. **[+ 新しいオブザーバブル]** ドロップダウンを選択し、**[ドメイン名]** を選択します。

1. [ドメイン] に、ドメイン名を入力します (例: 「*contoso.com*」と入力します)。

1. **[名前]** フィールドには、ドメインに使われているのと同じ値を入力します。

1. *[インジケーターの種類]* で、**[悪意のあるアクティビティ]** を選択します。

1. **[有効開始日]** フィールドを今日の日付に設定します。

1. **[記述]** まで下にスクロールし、「*このドメインは悪意があるとわかっている*」と入力します。

1. **[追加]** を選択します。

1. *Sentinel* ナビゲーション メニューの *[全般]* エリアの下で **[ログ]** オプションを選択します。 その方がよければ、[常にクエリを表示する] オプションを無効にし、*[クエリ]* ウィンドウを閉じて KQL ステートメントを実行します。

    >**注:** 既定の *[新規クエリ 1]* タブでは、**_GetWatchList('HighValueHosts')** クエリは引き続き存在する必要があり、実行すると結果が生成されるようになります。

1. *[+]* 記号を選択して、新しいクエリ タブを作成します。

1. 以下の KQL ステートメントを実行します。

    ```KQL
    ThreatIntelligenceIndicator
    ```

    >**注:** インジケーターが表示されるまで、最大 5 分かかる場合があります。

1. 結果を右にスクロールして、DomainName 列を表示します。 次の KQL ステートメントを実行して、DomainName 列だけを表示することもできます。

    ```KQL
    ThreatIntelligenceIndicator 
    | project DomainName
    ```

### タスク 6: ログ保持期間の構成

このタスクでは、SecurityEvent テーブルの保持期間を変更します。

1. Microsoft Sentinel で、 **[構成]** 領域の下の *[設定]* オプションを選択します。

1. **[ワークスペースの設定]** を選択します。

1. Log Analytics ワークスペースの、 *[設定]* 領域の下で **[テーブル]** オプションを選択します。

1. **SecurityEvent** テーブルを検索して選択してから、省略記号リンク (...) を選択します。

    >**注:** 省略記号リンクを表示するには、右にスクロールする必要がある場合があります。

1. **[テーブルの管理]** を選択します。

1. *対話型保持期間*を **90 日**に変更します。

1. *総保持期間*を **180 日**にリセットします (必要な場合)。 *Azure Monitor* は残り 90 日の総保持期間を低コストの長期保持として自動的に処理するため、*アーカイブ期間*は *90 日*に設定されるようになりました。

1. **[保存]** をクリックして変更を適用します。

## これでラボは完了です
