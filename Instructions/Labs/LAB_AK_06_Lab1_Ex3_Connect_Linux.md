---
lab:
    title: '演習 3 - データ コネクタを使用して Linux ホストを Microsoft Sentinel に接続する'
    module: 'モジュール 6 – ログを Microsoft Sentinel に接続する'
---

# モジュール 6 - ラボ 1 - 演習 3 - データ コネクタを使用して Linux ホストを Microsoft Sentinel に接続する


### タスク 1: Microsoft Sentinel ワークスペースにアクセスする。

このタスクでは、Microsoft Sentinel ワークスペースにアクセスします。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd** です。  

2. 新しい Microsoft Edge ブラウザーを起動します。

3. Microsoft Edge ブラウザーで Azure portal (https://portal.azure.com) に移動します。

4. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントの電子メール**アカウントをコピーして貼り付け、「**次へ**」を選択します。

5. **パスワードの入力**ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントパスワード** をコピーして貼り付け、「**サインイン**」を選択します。

6. Azure portal の検索バーに「*Sentinel*」と入力し、「**Microsoft Sentinel**」を選択します。

7. 前のラボで作成した Microsoft Sentinel ワークスペースを選択します。


### タスク 2: Common Event Format のコネクタを使用してLinuxホストを接続します。

このタスクでは、LinuxホストをCommon Event Format（CEF）コネクタを使用して Microsoft Sentinelに接続します。

1. Microsoft Sentinel の構成領域から「**データコネクタ**」を選択します。  「データ コネクタ」タブから、「**Common Event Format (CEF)**」コネクタを検索し、リストから選択します。

2. コネクタ情報ブレードで「**コネクタページを開く**」を選択します。

3. 「**1.2 Linux マシンへの CEF コレクターのインストール**」に示されているコマンドをクリップボードにコピーします。

4. LIN1 仮想マシンを起動し、ラボのホスティング業者から提供されたユーザー名とパスワードを使用してログインします。LIN1 サーバー IP アドレスを書き留めます。例として次のスクリーンショットをご覧ください。

   ![Linux ログイン](../Media/LinuxLoginExample.png)

5. WIN1 仮想マシンに戻り、スタート メニュー アイコンを右クリックして、管理者として、Windows PowerShell を起動し、「**Windows PowerShell (管理者)**」を選択します。「**はい**」を選択して、表示されるユーザー アカウント制御ウィンドウで、アプリの実行を許可します。

6. 次の PowerShell コマンドを入力し、特定の Linux サーバー情報に合わせて調整し、Enter キーを押します。

```PowerShell
ssh <insert your linux IP address here> -l <insert linux user name here>
```

7. 「*yes*」と入力して、接続を確認してから、ユーザーのパスワードを入力して、Enter キーを押します。画面は次のようになります。

   ![Linux ログイン](../Media/PSconnectLinux.png)

8. これで、前の手順の「**1.2 Linux マシンへの CEF コレクターのインストール**」に貼り付ける準備ができました。Azure のスクリプトがクリップボードにあることを確認してください。PowerShell で、トップ バーを右クリックし、「**編集**」、「**貼り付け**」の順に選択します。貼り付けたら、次に示すように **python** という単語に **3** を追加します。

   ![ConnectorScript](../Media/ConnectorScript.png)


9. スクリプトを貼り付けて調整したら、Enter キーを押します。スクリプトは Linux サーバーに対してリモートで実行されます。スクリプトが適切に処理されると、次の画面のようになります。

   ![ConnectorScript](../Media/LinuxConnected.png)


### タスク 3: Syslog コネクタを使用して Linux ホストを接続する。

このタスクでは、Linux ホストを　Syslog　コネクタを使用して　Microsoft　Sentinel　に接続します。

1. WIN1 に接続します。WIN1 は、ワークスペースの Microsoft Sentinel ポータルに既に存在しているはずです。  

2. 「データ コネクタ」タブから、「**Syslog**」コネクタを検索し、リストから選択します。

3. コネクタ情報ブレードで「**コネクタページを開く**」を選択します。

4. **Install agent on a non-Azure Linux Machine**セクションを開きます。

5. **Azure 以外の Linux マシンのエージェントをダウンロードしてインストールする** リンクを選択します。 

6. 「**Linuxサーバー**」のタブを選択します。

7. **Linux 用エージェントをダウンロードおよびオンボードする** 領域のコマンドをクリップボードにコピーします。

8. LIN2 仮想マシンを起動し、ラボのホスティング業者から提供されたユーザー名とパスワードを使用してログインします。LIN2 サーバー IP アドレスを書き留めます。例として次のスクリーンショットをご覧ください。

   ![Linux ログイン](../Media/LinuxLoginExample.png)

9. WIN1 仮想マシンに戻り、スタート メニュー アイコンを右クリックして、管理者として、新しい Windows PowerShell を起動し、「**Windows PowerShell (管理者)**」を選択します。「**はい**」を選択して、表示されるユーザー アカウント制御ウィンドウで、アプリの実行を許可します。

   >**注:** Windows PowerShell ウィンドウは、最後のタスクが「*インストール完了済み*」であれば、「*終了*」を入力して LIN1 への接続を閉じることにより、再使用できます。

10. 次の PowerShell コマンドを入力し、特定の Linux サーバー情報に合わせて調整し、Enter キーを押します。

```PowerShell
ssh <insert your linux IP address here> -l <insert linux user name here>
```

11. 「*yes*」と入力して、接続を確認してから、ユーザーのパスワードを入力して、Enter キーを押します。画面は次のようになります。

   ![Linux ログイン](../Media/PSconnectLinux.png)

12. これで、前の手順の「**Linux 用のダウンロードおよびオンボード エージェント**」に貼り付ける準備ができました。Azure のスクリプトがクリップボードにあることを確認してください。PowerShell で、トップ バーを右クリックし、「**編集**」、「**貼り付け**」の順に選択します。

13. スクリプトが貼り付けられたら、Enter キーを押します。スクリプトは Linux サーバーに対してリモートで実行されます。タスクが完了しました。このコースのこれ以上のラボは、この接続に依存していません。


### タスク 4: 収集するファシリティとその重大度をSyslogコネクタ用に設定します。

このタスクでは、Syslog収集機能を構成します。

1. WIN1仮想マシンに接続します。

2. Microsoft Sentinelポータルで、設定ブレードから「**設定**」、「**ワークスペース設定**」の順に選択します。

3. 「**設定**」領域で「**エージェント構成**」を選択します。

4. 「**Syslog**」タブを選択します。

5. 「**+ ファシリティの追加**」ボタンを選択します。

6. 「*ファシリティ名*」ドロップダウン メニューから「**auth**」を選択します。

7. 「**+ ファシリティの追加**」ボタンを再度選択します。

8. 「**ファシリティ名**」ドロップダウン メニューから「**authpriv**」を選択します。

9. 「**適用**」を選択します。  このタスクが完了しました。

## 演習 4 に進みます。
