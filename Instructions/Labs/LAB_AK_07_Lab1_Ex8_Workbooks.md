---
lab:
    title: '演習 8 - ワークブックを作成する'
    module: 'モジュール 7 – Microsoft Sentinel を使用して脅威を検出し、調査を実行する'
---

# モジュール 7 - ラボ 1 - 演習 8 - ワークブックを作成する

## ラボ シナリオ

あなたは、Microsoft Sentinel を実装した会社で働いているセキュリティ オペレーションアナリストです。高度な視覚化を使用してワークブックを設計する必要があります。


### タスク 1: ワークブックを調べる

このタスクでは、ブックの構成について説明します。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd** です。  

2. Microsoft Edge ブラウザーで Azure portal (https://portal.azure.com) に移動します。

3. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのメール** アカウントをコピーして貼り付け、「**次へ**」を選択します。

4. **パスワードの入力**ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントパスワード** をコピーして貼り付け、「**サインイン**」を選択します。

5. Azure portal の検索バーに「*Sentinel*」と入力し、「**Microsoft Sentinel**」を選択します。

6. Microsoft Sentinel ワークスペースを選択します。

7. 「**ブック** 」を選択します。

8. 「**ID およびアクセス**」を選択し、「**テンプレートの表示**」ボタンを選択します。

9. 「ID およびアクセス」ワークブックを確認します。

10. 右上隅の「X」を選択してワークブックを閉じます。「**Microsoft Sentinel - ワークブック - テンプレート**」タブが開いている筈です。

11. **テンプレート** タブで「**Azure AD 監査ログ**」を検索して選択してから、右側ペインから「**保存**」ボタンを選択します。 

12. 場所に適切な場所（例：米国東部）を選択して、「**OK**」を選択します。適切な場所は通常、既定です。

13. 「**保存されたワークブックの表示**」ボタンを選択します。

14. コマンドバーの「**Edit**」を選択します。

15. **User activities** 領域で、"Operations count" と "Trend" のグラフの色を確認してください。次に、下のグリッドにある「**Edit**」を選択します。

#### 列をフォーマットするには、列設定パネルにカスタマイズオプションがあるので、次のようにします。

16. クエリ コマンド バーの右側にある「**Column Settings**」ボタンを選択します。

    >**注:** このボタンは、レポートにデータがある場合のみ表示されます。

17. *Columns* ブレードで、**Operations Count (Heatmap + Formatted)** 列を選択します。

18. 設定、特に**Column renderer** のオプションを確認します。**Color palette** については、「**32 -color categorical**」 (32 色のカテゴリ別) を選択します。

19. 列 **Trend (Spark line + Formatted)** を選択します。

20. 設定を確認し、**Column renderer**については、「**Spark area**」を選択し、**Color palette** で選択した色を選択します。

21. 「**Save and Close**」を選択します。

#### あるタイル/グリッドのコントロールが、別のタイル/グリッドの結果をフィルタリングするには、次のようにします。

22. **Editing query item:query - 2**.で、「**Advanced Settings**」ボタンを選択します。

23. 「*When items are selected, export parameters*」の「**Allow selection of multiple values**」設定を確認します。**UserInfo** フィールドが選択されていることに注意してください。

24. クエリの下部にある「**編集完了**」を選択します (上部メニューではありません)。

25. 画面の右側にある「**Top active users**」グリッドの下の「**Edit**」を選択します。  

26. クエリの中で「*UserInfo*」を探します。このクエリは、他のクエリからエクスポートされたパラメータを使用して結果をフィルタリングしています。

27. クエリの下部にある「**編集完了**」を選択します (上部メニューではありません)。

28. ワークブックについては、上部メニューで、「**Done Editing**」を選択し、「**Save**」アイコンを選択します。右上隅の「x」を選択して、ワークブックを閉じます。


### タスク 2: ワークブックを作成します。

このタスクでは、高度な視覚化を備えた新しいワークブックを作成します。

1. Microsoft Sentinel portal の「**ワークブック**」領域に戻ります。

2. 「**+ ブックの追加**」を選択します

3. 「**Edit**」を選択します

#### ヘッダーテキストを編集します:

4. ワークブックのタイトルの下の「**Edit**」を選択し、**## New workbook** を **## My workbook**に変更します。

5. ヘッダー テキストのために、下部メニューから「**編集完了**」を選択します。

6. 表示される唯一のグラフの下で、「**Edit**」を選択します。

7. 複数のテーブルにわたるカウントの和集合を提供するKQLステートメントを確認してください。

8. グラフのために、下部メニューから「**編集完了**」を選択します。

9. グラフ領域の横の **「...」** を選択し、「**+ Add**」を選択し、「**Add query**」を選択します。

10. クエリ ボックスに「*SecurityEvent*」と入力し、「**Run Query**」ボタンを選択します。

11. *Time Range*を「**Last 30 minutes**」に変更します。

12. *Visualization* を「**Bar chart**」に変更して、結果を確認します。

13. *Visualization* を「**Time chart**」に変更して、結果を確認します。

14. クエリタブの「**Style**」を選択します。

15. 「**Make this item a custom width**」ボックスをチェックします。

16. Percent width を「**75**」に、Maximum width を「**75**」に設定します。

17. クエリタブの「**Advanced Settings**」を選択します。

18. 「**Show refresh icon when not editing**」ボックスをチェックします。 

19. 新しいグラフのために、下部メニューから「**編集完了**」を選択します。

20. ワークブックの下部で、「**Add**」を選択してから、「**Add query**」を選択します。

クエリに対して次の KQ Lコマンドを入力します。

```KQL
SecurityEvent
```

21. 「Time Range」で、「**Last 4 hours**」を選択します。

22. 「Visualization」 を「**Grid**」に変更します。

23. 「**Style**」タブを選択します。

24. 「**Make this item a custom width**」をチェックします。

25. Percent width を「**25**」、Maximum width を「**25**」に変更します。 

26. 新しいクエリのために、下部メニューから「**編集完了**」を選択します。

27. ワークブックの「**Done Editing**」を選択します。

28. 「**Save**」アイコンを選択し、*Title*を *My Workbook*、*Location* を*米国東部* に変更し、「**Save**」を再度選択します。

29. 右上の「x」を選択してワークブックを閉じるか、Microsoft Sentinel portal で「**ワークブック**」を選択します。

30. 必要に応じて、「**マイブック**」タブを選択します。

31. 作成したワークブックを選択します。

32. 「**保存されたブックの表示**」を選択します。

## これでラボは完了です。
