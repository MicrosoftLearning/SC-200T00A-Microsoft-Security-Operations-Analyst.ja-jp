---
lab:
  title: 演習 11 - Microsoft Sentinel でリポジトリを使用する
  module: Learning Path 9 - Create detections and perform investigations using Microsoft Sentinel
---

# ラーニング パス 9 - ラボ 1 - 演習 11 - Microsoft Sentinel でリポジトリを使用する

## ラボのシナリオ

あなたは、Microsoft Sentinel を実装した会社で働いているセキュリティ運用アナリストです。 あなたはスケジュール済みおよび Microsoft セキュリティ分析ルールを既に作成しています。  Azure DevOps リポジトリで分析ルールを一元化する必要があります。  次に、Sentinel を Azure DevOps リポジトリに接続し、コンテンツをインポートします。 

>**重要:** ラーニング パス #9 のラボ演習は、*スタンドアロン*環境にあります。 ラボを完了せずに終了する場合は、構成を再実行する必要があります。

### このラボの推定所要時間: 30 分

### タスク 1:分析ルールを作成してエクスポートする

このタスクでは、Microsoft Sentinel でエンティティ行動分析を有効にします。

>**注:** Microsoft Sentinel は、**defenderWorkspace** という名前で Azure サブスクリプションに事前にデプロイされており、必要な *Content Hub* ソリューションがインストールされています。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd**。  

1. **[サインイン]** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントの電子メール** アカウントをコピーして貼り付け、 **[次へ]** を選択します。

1. **[パスワードの入力]** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのパスワード**をコピーして貼り付け、 **[サインイン]** を選択します。

1. Azure portal の検索バーに「*Sentinel*」と入力してから、**[Microsoft Sentinel]** を選択します。

1. Microsoft Sentinel **defenderWorkspace** を選択します。

1. 左側のブレードの [構成] 領域で **[分析]** を選びます。**

1. 前に作成した **Startup RegKey** ルールを選びます。

1. ツール バーの **[エクスポート]** を選びます。 **ヒント:** 省略記号アイコン **[...]** を選んで表示することが必要な場合があります。

1. ルールは *、Azure_Sentinel_analytic_rule.json* という名前のテキスト ファイルにエクスポートされます。

1. ダウンロードしたファイルの名前の下にある **[ファイルを開く]** を選んで、 **[その他のアプリ]** を選びます。

1. **[メモ帳]** を選んで、 **[OK]** を選びます。

1. Azure Resource Manager テンプレートを確認し、済んだら閉じます。

### タスク 2:Azure DevOps 環境を作成する

このタスクでは、Azure DevOps リポジトリを作成します。

1. ブラウザーで別のタブを開き、(<https://aexprodcus1.vsaex.visualstudio.com/me?mkt=en-US>) に移動します。

1. *[We need a few more details](詳細情報をいくつか入力する必要があります)* ページで、 **[続行]** を選びます。

1. [Azure DevOps の概要] ページで、 **[新しい組織の作成]** を選んでから、 **[続行]** を選びます。**

    >**注:** 1 分以上経過してもこの操作が完了しない場合は、ブラウザー ページを**更新**します (Ctrl + R キーを押します)。

1. *[まもなく完了します]* ページで、今後使用しない DevOps 組織の名前 (テナント プレフィックスなど) を入力します。

    >**ヒント:** ご自分のラボの [リソース] タブにあります (WWLx...)。

1. *"表示される文字を入力し"* 、 **[続行]** します。

1. *[プロジェクトを作成して開始します]* ページで、「**My Sentinel コンテンツ**」と入力し、 **[プロジェクトの作成]** を選択します。

1. 左側のペインで**リポジトリ**に移動します。

1. ページの下部にある *[Initialize main branch with a README or gitignore](README または gitignore を使用してメイン ブランチを初期化する)* 領域で、 **[初期化]** を選択します。

1. ページに、リポジトリのファイルが表示されます。  唯一のファイルは README.me です。

1. [ファイル] (ページの右側) ブレードのツール バーには、[ビルドのセットアップ] や [複製] オプションが含まれます。コロン アイコン **(:)** を選んで、その他のオプションを表示します。** **

1. **[ファイルのアップロード]** を選択します。

1. **[参照]** を選択し、*"ダウンロード"* ディレクトリからファイル **Azure_Sentinel_analytic_rule.json** を選択し、**[開く]** を選択します。

1. **[コミット]** を選択します。

1. ページの左上隅にある **[Azure DevOps]** を選択します。  これにより、組織とプロジェクトが表示されます。

1. ページの左下にある **[組織の設定]** を選択します。

1. 左側のブレードの [セキュリティ] 領域の下にある **[ポリシー]** を選びます。**

1. [アプリケーション接続ポリシー] 領域で [OAuth を使用したサード パーティ アプリケーションのアクセス] を **[オン]** にします。** **


### タスク 3:Sentinel を Azure DevOps に接続する。

1. ブラウザーで *[Azure portal]* / *[Microsoft Sentinel]* タブを選択します。

1. Microsoft Sentinel で、 *[コンテンツ管理]* セクションの **[リポジトリ (プレビュー)]** を選択します。

1. ツール バーの **[+ 新規追加]** ボタンを選びます。

1. 名前に「**My Content**」と入力します。

1. ソース管理に対して、 **[Azure DevOps]** を選択します。

1. **[承認]** を選択します。 アクセス許可要求を下にスクロールし、 **[承諾]** を選択します。

1. 先ほど作成した組織 (WWLx など) を選択します。

1. 先ほど作成したプロジェクト、 *[My Sentinel コンテンツ]* を選択します。

1. 先ほど作成したリポジトリ、 *[My Sentinel コンテンツ]* を選択します。 **ヒント:** リポジトリを表示するには、ドロップダウン内で下にスクロールする必要がある場合があります。

1. **main** ブランチを選択します。 **ヒント:** ブランチを表示するには、ドロップダウン内で下にスクロールする必要がある場合があります。

1. すべてのコンテンツ タイプを選択します。

1. **[作成]** を選択します。

1. 必要に応じて Microsoft Sentinel ワークスペースに戻る

1. *[リポジトリ (プレビュー)]* ページに移動し、 **[更新]** を選択します。 *[最後の配置の状態]* が *[失敗]* になるまで待ちます。  

    >**注:** *[失敗]* の状態になるのは、ホストされているラボ環境の制限が原因です。 通常は *[成功]* と表示されます。 その後、 *[分析]* で、インポートされたルール *[Rule from Azure DevOps]* を確認できます。

## これでラボは完了です。
